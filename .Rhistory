mutate(num = row_number()) %>%
mutate(sous_seuil = spo2 < seuil) %>%
group_by(grp = cumsum(c(FALSE, diff(sous_seuil) != 0))) %>%
ungroup()
#Calcul de la durée totale
duree_totale <- tail(donnees$duree_cumulee,1)
#Filtrage des données en dessous du seuil
data_sub_seuil <- donnees %>%
filter(sous_seuil)
# Calculer l'aire sous le seuil pour chaque groupe
data_sub_seuil_aire <- data_sub_seuil %>%
group_by(grp) %>%
summarise(aire_sous_seuil = AUC(as.numeric(heure), abs(spo2-seuil), na.rm = TRUE)) %>%
replace_na(list(aire_sous_seuil = 0))
# Somme des aires de chaque groupe
somme_aires <- sum(data_sub_seuil_aire$aire_sous_seuil)/3600
# Calculer la moyenne mobile
donnees$smoothed_mean <- rollmean(donnees$spo2, k = 5, fill = NA, align = "center")
# Utiliser des splines de lissage
smooth_spline <- smooth.spline(donnees$heure, donnees$spo2)
donnees$heure_numeric <- as.numeric(donnees$heure)
donnees$smoothed_spline <- predict(smooth_spline, donnees$heure_numeric)$y
# Tracer le graphique de l'évolution de la SpO2
ggplot(donnees, aes(x = heure, y = spo2)) +
geom_line() +
geom_line(aes(y = smoothed_spline), color = "red", size = 1) +
geom_hline(yintercept = spo2_max, linetype = "dashed", color = "red", size = 1) +
geom_hline(yintercept = spo2_min, linetype = "dashed", color = "blue", size = 1) +
geom_hline(yintercept = seuil, linetype = "dashed", color = "green", size = 1) +
geom_ribbon(data = data_sub_seuil, aes(ymin = spo2, ymax = seuil,group = grp), fill = "blue", alpha = 0.3) +
labs(title = "Évolution de la SpO2 au cours du temps",
x = "Temps",
y = "SpO2")
# Somme des aires de chaque groupe
HB <- sum(data_sub_seuil_aire$aire_sous_seuil)/duree_totale #%
REDTA <- sum(data_sub_seuil_aire$aire_sous_seuil)/3600 #%h
# Tracer le graphique de l'évolution de la SpO2
ggplot(donnees, aes(x = heure, y = spo2)) +
geom_line() +
geom_line(aes(y = smoothed_spline), color = "red", size = 0.5) +
geom_hline(yintercept = spo2_max, linetype = "dashed", color = "red", size = 1) +
geom_hline(yintercept = spo2_min, linetype = "dashed", color = "blue", size = 1) +
geom_hline(yintercept = seuil, linetype = "dashed", color = "green", size = 1) +
geom_ribbon(data = data_sub_seuil, aes(ymin = spo2, ymax = seuil,group = grp), fill = "blue", alpha = 0.3) +
labs(title = "Évolution de la SpO2 au cours du temps",
x = "Temps",
y = "SpO2")
# Tracer le graphique de l'évolution de la SpO2
ggplot(donnees, aes(x = heure, y = spo2)) +
geom_line() +
geom_line(aes(y = smoothed_spline), color = "yellow", size = 0.5) +
geom_hline(yintercept = spo2_max, linetype = "dashed", color = "red", size = 1) +
geom_hline(yintercept = spo2_min, linetype = "dashed", color = "blue", size = 1) +
geom_hline(yintercept = seuil, linetype = "dashed", color = "green", size = 1) +
geom_ribbon(data = data_sub_seuil, aes(ymin = spo2, ymax = seuil,group = grp), fill = "blue", alpha = 0.3) +
labs(title = "Évolution de la SpO2 au cours du temps",
x = "Temps",
y = "SpO2")
# Tracer le graphique de l'évolution de la SpO2
ggplot(donnees, aes(x = heure, y = spo2)) +
geom_line() +
geom_line(aes(y = smoothed_spline), color = "red", size = 0.5) +
geom_hline(yintercept = spo2_max, linetype = "dashed", color = "red", size = 1) +
geom_hline(yintercept = spo2_min, linetype = "dashed", color = "blue", size = 1) +
geom_hline(yintercept = seuil, linetype = "dashed", color = "green", size = 1) +
geom_ribbon(data = data_sub_seuil, aes(ymin = spo2, ymax = seuil,group = grp), fill = "blue", alpha = 0.3) +
labs(title = "Évolution de la SpO2 au cours du temps",
x = "Temps",
y = "SpO2")
# Tracer le graphique de l'évolution de la SpO2
ggplot(donnees, aes(x = heure, y = spo2)) +
#geom_line() +
geom_line(aes(y = smoothed_spline), color = "red", size = 0.5) +
geom_hline(yintercept = spo2_max, linetype = "dashed", color = "red", size = 1) +
geom_hline(yintercept = spo2_min, linetype = "dashed", color = "blue", size = 1) +
geom_hline(yintercept = seuil, linetype = "dashed", color = "green", size = 1) +
geom_ribbon(data = data_sub_seuil, aes(ymin = spo2, ymax = seuil,group = grp), fill = "blue", alpha = 0.3) +
labs(title = "Évolution de la SpO2 au cours du temps",
x = "Temps",
y = "SpO2")
View(data_sub_seuil)
# Tracer le graphique de l'évolution de la SpO2
ggplot(donnees, aes(x = heure, y = spo2)) +
#geom_line() +
geom_line(aes(y = smoothed_spline), color = "red", size = 0.5) +
geom_hline(yintercept = spo2_max, linetype = "dashed", color = "red", size = 1) +
geom_hline(yintercept = spo2_min, linetype = "dashed", color = "blue", size = 1) +
geom_hline(yintercept = seuil, linetype = "dashed", color = "green", size = 1) +
geom_ribbon(data = data_sub_seuil, aes(ymin = spo2, ymax = seuil,group = grp), fill = "blue", alpha = 0.3) +
labs(title = "Évolution de la SpO2 au cours du temps",
x = "Temps",
y = "SpO2"
) +
legend("title")
# Tracer le graphique de l'évolution de la SpO2
ggplot(donnees, aes(x = heure, y = spo2)) +
#geom_line() +
geom_line(aes(y = smoothed_spline), color = "red", size = 0.5) +
geom_hline(yintercept = spo2_max, linetype = "dashed", color = "red", size = 1) +
geom_hline(yintercept = spo2_min, linetype = "dashed", color = "blue", size = 1) +
geom_hline(yintercept = seuil, linetype = "dashed", color = "green", size = 1) +
geom_ribbon(data = data_sub_seuil, aes(ymin = spo2, ymax = seuil,group = grp), fill = "blue", alpha = 0.3) +
labs(title = "Évolution de la SpO2 au cours du temps",
x = "Temps",
y = "SpO2"
) +
legend("HB")
# Tracer le graphique de l'évolution de la SpO2
ggplot(donnees, aes(x = heure, y = spo2)) +
#geom_line() +
geom_line(aes(y = smoothed_spline), color = "red", size = 0.5) +
geom_hline(yintercept = spo2_max, linetype = "dashed", color = "red", size = 1) +
geom_hline(yintercept = spo2_min, linetype = "dashed", color = "blue", size = 1) +
geom_hline(yintercept = seuil, linetype = "dashed", color = "green", size = 1) +
geom_ribbon(data = data_sub_seuil, aes(ymin = spo2, ymax = seuil,group = grp), fill = "blue", alpha = 0.3) +
labs(title = "Évolution de la SpO2 au cours du temps",
x = "Temps",
y = "SpO2"
) +
legend("topright")
# Tracer le graphique de l'évolution de la SpO2
ggplot(donnees, aes(x = heure, y = spo2)) +
#geom_line() +
geom_line(aes(y = smoothed_spline), color = "red", size = 0.5) +
geom_hline(yintercept = spo2_max, linetype = "dashed", color = "red", size = 1) +
geom_hline(yintercept = spo2_min, linetype = "dashed", color = "blue", size = 1) +
geom_hline(yintercept = seuil, linetype = "dashed", color = "green", size = 1) +
geom_ribbon(data = data_sub_seuil, aes(ymin = spo2, ymax = seuil,group = grp), fill = "blue", alpha = 0.3) +
labs(title = "Évolution de la SpO2 au cours du temps",
x = "Temps",
y = "SpO2",
HB = "HB")
# Tracer le graphique de l'évolution de la SpO2
ggplot(donnees, aes(x = heure, y = spo2)) +
#geom_line() +
geom_label(aes(x = 80, y = max(values), label = paste("Moyenne =", round(calculated_value, 2))),
fill = "white", color = "black", size = 4) +  # Ajouter la boîte de texte
geom_line(aes(y = smoothed_spline), color = "red", size = 0.5) +
geom_hline(yintercept = spo2_max, linetype = "dashed", color = "red", size = 1) +
geom_hline(yintercept = spo2_min, linetype = "dashed", color = "blue", size = 1) +
geom_hline(yintercept = seuil, linetype = "dashed", color = "green", size = 1) +
geom_ribbon(data = data_sub_seuil, aes(ymin = spo2, ymax = seuil,group = grp), fill = "blue", alpha = 0.3) +
labs(title = "Évolution de la SpO2 au cours du temps",
x = "Temps",
y = "SpO2")
# Tracer le graphique de l'évolution de la SpO2
ggplot(donnees, aes(x = heure, y = spo2)) +
#geom_line() +
geom_label(aes(x = 80, y = max(values), label = paste("Moyenne =", round(HB, 2))),
fill = "white", color = "black", size = 4) +  # Ajouter la boîte de texte
geom_line(aes(y = smoothed_spline), color = "red", size = 0.5) +
geom_hline(yintercept = spo2_max, linetype = "dashed", color = "red", size = 1) +
geom_hline(yintercept = spo2_min, linetype = "dashed", color = "blue", size = 1) +
geom_hline(yintercept = seuil, linetype = "dashed", color = "green", size = 1) +
geom_ribbon(data = data_sub_seuil, aes(ymin = spo2, ymax = seuil,group = grp), fill = "blue", alpha = 0.3) +
labs(title = "Évolution de la SpO2 au cours du temps",
x = "Temps",
y = "SpO2")
# Tracer le graphique de l'évolution de la SpO2
ggplot(donnees, aes(x = heure, y = spo2)) +
#geom_line() +
geom_label(data = HB, aes(x = 80, y = max(values), label = paste("Moyenne =", round(HB, 2))),
fill = "white", color = "black", size = 4) +  # Ajouter la boîte de texte
geom_line(aes(y = smoothed_spline), color = "red", size = 0.5) +
geom_hline(yintercept = spo2_max, linetype = "dashed", color = "red", size = 1) +
geom_hline(yintercept = spo2_min, linetype = "dashed", color = "blue", size = 1) +
geom_hline(yintercept = seuil, linetype = "dashed", color = "green", size = 1) +
geom_ribbon(data = data_sub_seuil, aes(ymin = spo2, ymax = seuil,group = grp), fill = "blue", alpha = 0.3) +
labs(title = "Évolution de la SpO2 au cours du temps",
x = "Temps",
y = "SpO2")
# Tracer le graphique de l'évolution de la SpO2
ggplot(donnees, aes(x = heure, y = spo2)) +
#geom_line() +
geom_label(data = HB, aes( label = paste("Moyenne =", round(HB, 2))),
fill = "white", color = "black", size = 4) +  # Ajouter la boîte de texte
geom_line(aes(y = smoothed_spline), color = "red", size = 0.5) +
geom_hline(yintercept = spo2_max, linetype = "dashed", color = "red", size = 1) +
geom_hline(yintercept = spo2_min, linetype = "dashed", color = "blue", size = 1) +
geom_hline(yintercept = seuil, linetype = "dashed", color = "green", size = 1) +
geom_ribbon(data = data_sub_seuil, aes(ymin = spo2, ymax = seuil,group = grp), fill = "blue", alpha = 0.3) +
labs(title = "Évolution de la SpO2 au cours du temps",
x = "Temps",
y = "SpO2")
# Tracer le graphique de l'évolution de la SpO2
ggplot(donnees, aes(x = heure, y = spo2)) +
#geom_line() +
geom_label( aes( label = paste("Moyenne =", round(HB, 2))),
fill = "white", color = "black", size = 4) +  # Ajouter la boîte de texte
geom_line(aes(y = smoothed_spline), color = "red", size = 0.5) +
geom_hline(yintercept = spo2_max, linetype = "dashed", color = "red", size = 1) +
geom_hline(yintercept = spo2_min, linetype = "dashed", color = "blue", size = 1) +
geom_hline(yintercept = seuil, linetype = "dashed", color = "green", size = 1) +
geom_ribbon(data = data_sub_seuil, aes(ymin = spo2, ymax = seuil,group = grp), fill = "blue", alpha = 0.3) +
labs(title = "Évolution de la SpO2 au cours du temps",
x = "Temps",
y = "SpO2")
# Tracer le graphique de l'évolution de la SpO2
ggplot(donnees, aes(x = heure, y = spo2)) +
#geom_line() +
geom_line(aes(y = smoothed_spline), color = "red", size = 0.5) +
geom_hline(yintercept = spo2_max, linetype = "dashed", color = "red", size = 1) +
geom_hline(yintercept = spo2_min, linetype = "dashed", color = "blue", size = 1) +
geom_hline(yintercept = seuil, linetype = "dashed", color = "green", size = 1) +
geom_ribbon(data = data_sub_seuil, aes(ymin = spo2, ymax = seuil,group = grp), fill = "blue", alpha = 0.3) +
labs(title = "Évolution de la SpO2 au cours du temps",
x = "Temps",
y = "SpO2") +
annotate("text", x = min(donnees$heure), y = max(donnees$spo2),
label = paste("HB =", round(HB, 2)), hjust = 0, vjust = 1, color = "black") +
annotate("text", x = min(donnees$heure), y = max(donnees$spo2) - 5,
label = paste("REDTA =", round(REDTA, 2)), hjust = 0, vjust = 1, color = "black") +
theme_minimal()
# Tracer le graphique de l'évolution de la SpO2
ggplot(donnees, aes(x = heure, y = spo2)) +
#geom_line() +
geom_line(aes(y = smoothed_spline), color = "red", size = 0.5) +
geom_hline(yintercept = spo2_max, linetype = "dashed", color = "red", size = 1) +
geom_hline(yintercept = spo2_min, linetype = "dashed", color = "blue", size = 1) +
geom_hline(yintercept = seuil, linetype = "dashed", color = "green", size = 1) +
geom_ribbon(data = data_sub_seuil, aes(ymin = spo2, ymax = seuil,group = grp), fill = "blue", alpha = 0.3) +
labs(title = "Évolution de la SpO2 au cours du temps",
x = "Temps",
y = "SpO2") +
annotate("text", x = max(donnees$heure), y = max(donnees$spo2),
label = paste("HB =", round(HB, 2), "\nREDTA =", round(REDTA, 2)),
hjust = 1, vjust = 1, color = "black", size = 4,
family = "sans", face = "bold") +
theme_minimal()
# Tracer le graphique de l'évolution de la SpO2
ggplot(donnees, aes(x = heure, y = spo2)) +
#geom_line() +
geom_line(aes(y = smoothed_spline), color = "red", size = 0.5) +
geom_hline(yintercept = spo2_max, linetype = "dashed", color = "red", size = 1) +
geom_hline(yintercept = spo2_min, linetype = "dashed", color = "blue", size = 1) +
geom_hline(yintercept = seuil, linetype = "dashed", color = "green", size = 1) +
geom_ribbon(data = data_sub_seuil, aes(ymin = spo2, ymax = seuil,group = grp), fill = "blue", alpha = 0.3) +
labs(title = "Évolution de la SpO2 au cours du temps",
x = "Temps",
y = "SpO2") +
annotate("text", x = max(donnees$heure), y = max(donnees$spo2)-10,
label = paste("HB =", round(HB, 2), "\nREDTA =", round(REDTA, 2)),
hjust = 1, vjust = 1, color = "black", size = 4,
family = "sans", face = "bold") +
theme_minimal()
# Tracer le graphique de l'évolution de la SpO2
ggplot(donnees, aes(x = heure, y = spo2)) +
#geom_line() +
geom_line(aes(y = smoothed_spline), color = "red", size = 0.5) +
geom_hline(yintercept = spo2_max, linetype = "dashed", color = "red", size = 1) +
geom_hline(yintercept = spo2_min, linetype = "dashed", color = "blue", size = 1) +
geom_hline(yintercept = seuil, linetype = "dashed", color = "green", size = 1) +
geom_ribbon(data = data_sub_seuil, aes(ymin = spo2, ymax = seuil,group = grp), fill = "blue", alpha = 0.3) +
labs(title = "Évolution de la SpO2 au cours du temps",
x = "Temps",
y = "SpO2") +
annotate("text", x = max(donnees$heure), y = max(donnees$spo2)-5,
label = paste("HB =", round(HB, 2), "\nREDTA =", round(REDTA, 2)),
hjust = 1, vjust = 1, color = "black", size = 4,
family = "sans", face = "bold") +
theme_minimal()
# Tracer le graphique de l'évolution de la SpO2
ggplot(donnees, aes(x = heure, y = spo2)) +
#geom_line() +
geom_line(aes(y = smoothed_spline), color = "red", size = 0.5) +
geom_hline(yintercept = spo2_max, linetype = "dashed", color = "red", size = 1) +
geom_hline(yintercept = spo2_min, linetype = "dashed", color = "blue", size = 1) +
geom_hline(yintercept = seuil, linetype = "dashed", color = "green", size = 1) +
geom_ribbon(data = data_sub_seuil, aes(ymin = spo2, ymax = seuil,group = grp), fill = "blue", alpha = 0.3) +
labs(title = "Évolution de la SpO2 au cours du temps",
x = "Temps",
y = "SpO2") +
annotate("text", x = max(donnees$heure), y = max(donnees$spo2)-5,
label = paste("HB =", round(HB, 5), "\nREDTA =", round(REDTA, 5)),
hjust = 1, vjust = 1, color = "black", size = 4,
family = "sans", face = "bold") +
theme_minimal()
# Tracer le graphique de l'évolution de la SpO2
ggplot(donnees, aes(x = heure, y = spo2)) +
#geom_line() +
geom_line(aes(y = smoothed_spline), color = "red", size = 0.5) +
geom_hline(yintercept = spo2_max, linetype = "dashed", color = "red", size = 1) +
geom_hline(yintercept = spo2_min, linetype = "dashed", color = "blue", size = 1) +
geom_hline(yintercept = seuil, linetype = "dashed", color = "green", size = 1) +
geom_ribbon(data = data_sub_seuil, aes(ymin = spo2, ymax = seuil,group = grp), fill = "blue", alpha = 0.3) +
labs(title = "Évolution de la SpO2 au cours du temps",
x = "Temps",
y = "SpO2") +
annotate("text", x = max(donnees$heure), y = max(donnees$spo2)-5,
label = paste("HB =", round(HB, 5)*100, "\nREDTA =", round(REDTA, 5)*100),
hjust = 1, vjust = 1, color = "black", size = 4,
family = "sans", face = "bold") +
theme_minimal()
# Tracer le graphique de l'évolution de la SpO2
ggplot(donnees, aes(x = heure, y = spo2)) +
#geom_line() +
geom_line(aes(y = smoothed_spline), color = "red", size = 0.5) +
geom_hline(yintercept = spo2_max, linetype = "dashed", color = "red", size = 1) +
geom_hline(yintercept = spo2_min, linetype = "dashed", color = "blue", size = 1) +
geom_hline(yintercept = seuil, linetype = "dashed", color = "green", size = 1) +
geom_ribbon(data = data_sub_seuil, aes(ymin = spo2, ymax = seuil,group = grp), fill = "blue", alpha = 0.3) +
labs(title = "Évolution de la SpO2 au cours du temps",
x = "Temps",
y = "SpO2") +
annotate("text", x = max(donnees$heure), y = max(donnees$spo2)-5,
label = paste("HB =", round(HB, 5)*100, "\nREDTA =", round(REDTA, 5)*100),
hjust = 1, vjust = 1, color = "black", size = 4) +
theme_minimal()
# Tracer le graphique de l'évolution de la SpO2
ggplot(donnees, aes(x = heure, y = spo2)) +
#geom_line() +
geom_line(aes(y = smoothed_spline), color = "red", size = 0.5) +
geom_hline(yintercept = spo2_max, linetype = "dashed", color = "red", size = 1) +
geom_hline(yintercept = spo2_min, linetype = "dashed", color = "blue", size = 1) +
geom_hline(yintercept = seuil, linetype = "dashed", color = "green", size = 1) +
geom_ribbon(data = data_sub_seuil, aes(ymin = spo2, ymax = seuil,group = grp), fill = "blue", alpha = 0.3) +
labs(title = "Évolution de la SpO2 au cours du temps",
x = "Temps",
y = "SpO2") +
annotate("text", x = max(donnees$heure), y = max(donnees$spo2)-5,
label = paste("HB =", round(HB, 5)*100, "\nREDTA =", round(REDTA, 5)*100),
hjust = 1, vjust = 1, color = "black", size = 4)
# Tracer le graphique de l'évolution de la SpO2
ggplot(donnees, aes(x = heure, y = spo2)) +
#geom_line() +
geom_line(aes(y = smoothed_spline), color = "red", size = 0.5) +
geom_hline(yintercept = spo2_max, linetype = "dashed", color = "red", size = 1) +
geom_hline(yintercept = spo2_min, linetype = "dashed", color = "blue", size = 1) +
geom_hline(yintercept = seuil, linetype = "dashed", color = "green", size = 1) +
geom_ribbon(data = data_sub_seuil, aes(ymin = spo2, ymax = seuil,group = grp), fill = "blue", alpha = 0.3) +
labs(title = "Évolution de la SpO2 au cours du temps",
x = "Temps",
y = "SpO2") +
annotate("text", x = max(donnees$heure), y = max(donnees$spo2)-5,
label = paste("HB =", round(HB, 5)*100, "%", "\nREDTA =", round(REDTA, 5)*100),
hjust = 1, vjust = 1, color = "black", size = 4)
# Tracer le graphique de l'évolution de la SpO2
ggplot(donnees, aes(x = heure, y = spo2)) +
#geom_line() +
geom_line(aes(y = smoothed_spline), color = "red", size = 0.5) +
geom_hline(yintercept = spo2_max, linetype = "dashed", color = "red", size = 1) +
geom_hline(yintercept = spo2_min, linetype = "dashed", color = "blue", size = 1) +
geom_hline(yintercept = seuil, linetype = "dashed", color = "green", size = 1) +
geom_ribbon(data = data_sub_seuil, aes(ymin = spo2, ymax = seuil,group = grp), fill = "blue", alpha = 0.3) +
labs(title = "Évolution de la SpO2 au cours du temps",
x = "Temps",
y = "SpO2") +
annotate("text", x = max(donnees$heure), y = max(donnees$spo2)-5,
label = paste("HB =", round(HB, 5)*100, "%", "\nREDTA =", round(REDTA, 5)*100),"%h",
hjust = 1, vjust = 1, color = "black", size = 4)
# Tracer le graphique de l'évolution de la SpO2
ggplot(donnees, aes(x = heure, y = spo2)) +
#geom_line() +
geom_line(aes(y = smoothed_spline), color = "red", size = 0.5) +
geom_hline(yintercept = spo2_max, linetype = "dashed", color = "red", size = 1) +
geom_hline(yintercept = spo2_min, linetype = "dashed", color = "blue", size = 1) +
geom_hline(yintercept = seuil, linetype = "dashed", color = "green", size = 1) +
geom_ribbon(data = data_sub_seuil, aes(ymin = spo2, ymax = seuil,group = grp), fill = "blue", alpha = 0.3) +
labs(title = "Évolution de la SpO2 au cours du temps",
x = "Temps",
y = "SpO2") +
annotate("text", x = max(donnees$heure), y = max(donnees$spo2)-5,
label = paste("HB =", round(HB, 5)*100, "%", "\nREDTA =", round(REDTA, 5)*100,,"%h"),
hjust = 1, vjust = 1, color = "black", size = 4)
# Tracer le graphique de l'évolution de la SpO2
ggplot(donnees, aes(x = heure, y = spo2)) +
#geom_line() +
geom_line(aes(y = smoothed_spline), color = "red", size = 0.5) +
geom_hline(yintercept = spo2_max, linetype = "dashed", color = "red", size = 1) +
geom_hline(yintercept = spo2_min, linetype = "dashed", color = "blue", size = 1) +
geom_hline(yintercept = seuil, linetype = "dashed", color = "green", size = 1) +
geom_ribbon(data = data_sub_seuil, aes(ymin = spo2, ymax = seuil,group = grp), fill = "blue", alpha = 0.3) +
labs(title = "Évolution de la SpO2 au cours du temps",
x = "Temps",
y = "SpO2") +
annotate("text", x = max(donnees$heure), y = max(donnees$spo2)-5,
label = paste("HB =", round(HB, 5)*100, "%", "\nREDTA =", round(REDTA, 5)*100,"%h"),
hjust = 1, vjust = 1, color = "black", size = 4)
# Somme des aires de chaque groupe
HB <- 60*sum(data_sub_seuil_aire$aire_sous_seuil)duree_totale #%
# Somme des aires de chaque groupe
HB <- 60*sum(data_sub_seuil_aire$aire_sous_seuil)/duree_totale #%
library(tidyverse)
library(lubridate)
library(ggplot2)
library(DescTools)
library(zoo)
# Chemin vers votre fichier .asc
file_path <- "~/Documents/DU DATAS/STAGE/HYPOXPERF - SpO2/BESSON ACHILLE - 01-12-2024.asc"
# Lire le fichier en ignorant les 10 premières lignes
data <- read.csv(file_path, skip = 20, header = FALSE, sep = ",", stringsAsFactors = FALSE)
# Définir les seuils
spo2_max <- 95
spo2_min <- 85
seuil <- 92
donnees <- data %>%
select(-V1) %>%
rename(annee = V2,
mois = V3,
jour = V4,
heure = V5,
minute = V6,
seconde = V7,
pouls = V8,
spo2 = V9) %>%
mutate(date = make_datetime(annee, mois, jour, heure, minute, seconde)) %>%
select(date, spo2) %>%
separate(date, into = c("date", "heure"),sep =" ") %>%
filter(spo2 < spo2_max, spo2 > spo2_min) %>%
mutate(heure = ymd_hms(paste(date, heure)))
donnees <- donnees %>%
mutate(interval = as.numeric(difftime(heure, lag(heure, default = first(heure)), units = "secs"))) %>%
mutate(duree_cumulee = cumsum(interval)) %>%
mutate(num = row_number()) %>%
mutate(sous_seuil = spo2 < seuil) %>%
group_by(grp = cumsum(c(FALSE, diff(sous_seuil) != 0))) %>%
ungroup()
#Calcul de la durée totale
duree_totale <- tail(donnees$duree_cumulee,1)
#Filtrage des données en dessous du seuil
data_sub_seuil <- donnees %>%
filter(sous_seuil)
# Calculer l'aire sous le seuil pour chaque groupe
data_sub_seuil_aire <- data_sub_seuil %>%
group_by(grp) %>%
summarise(aire_sous_seuil = AUC(as.numeric(heure), abs(spo2-seuil), na.rm = TRUE)) %>%
replace_na(list(aire_sous_seuil = 0))
# Somme des aires de chaque groupe
HB <- 60*sum(data_sub_seuil_aire$aire_sous_seuil)/duree_totale #%min
REDTA <- sum(data_sub_seuil_aire$aire_sous_seuil)/3600 #%h
# Utiliser des splines de lissage
smooth_spline <- smooth.spline(donnees$heure, donnees$spo2)
donnees$heure_numeric <- as.numeric(donnees$heure)
donnees$smoothed_spline <- predict(smooth_spline, donnees$heure_numeric)$y
# Tracer le graphique de l'évolution de la SpO2
ggplot(donnees, aes(x = heure, y = spo2)) +
#geom_line() +
geom_line(aes(y = smoothed_spline), color = "red", size = 0.5) +
geom_hline(yintercept = spo2_max, linetype = "dashed", color = "red", size = 1) +
geom_hline(yintercept = spo2_min, linetype = "dashed", color = "blue", size = 1) +
geom_hline(yintercept = seuil, linetype = "dashed", color = "green", size = 1) +
geom_ribbon(data = data_sub_seuil, aes(ymin = spo2, ymax = seuil,group = grp), fill = "blue", alpha = 0.3) +
labs(title = "Évolution de la SpO2 au cours du temps",
x = "Temps",
y = "SpO2") +
annotate("text", x = max(donnees$heure), y = max(donnees$spo2)-5,
label = paste("HB =", round(HB, 5), "%", "\nREDTA =", round(REDTA, 5),"%h"),
hjust = 1, vjust = 1, color = "black", size = 4)
# Chemin vers votre fichier .asc
file_path <- "~/Documents/DU DATAS/STAGE/HYPOXPERF - SpO2/DODET SANDRA - 09-08-2023.asc"
source("~/Documents/DU DATAS/STAGE/HYPOXPERF - SpO2/step1.R", echo=TRUE)
source("~/Documents/DU DATAS/STAGE/HYPOXPERF - SpO2/step1.R", echo=TRUE)
source("~/Documents/DU DATAS/STAGE/HYPOXPERF - SpO2/step1.R", echo=TRUE)
shiny::runApp('Documents/DU DATAS/STAGE/HYPOXPERF - SpO2/_athlete-visualization-app')
library(shiny)
library(tidyverse)
library(lubridate)
library(ggplot2)
library(DescTools)
library(zoo)
library(bslib)
# CHARGEMENT DES FONCTIONS
source("R/data_processing.R")
setwd("~/Documents/DU DATAS/STAGE/HYPOXPERF - SpO2/_athlete-visualization-app")
# DEFINITION DE L'ESPACE DE TRAVAIL
setwd("~/Documents/DU DATAS/STAGE/HYPOXPERF - SpO2/_athlete-visualization-app")
# CHARGEMENT DES FONCTIONS
source("R/data_processing.R")
source("R/plotting.R")
# CHARGEMENT DES FONCTIONS
source("R/data_processing.R")
runApp()
runApp()
# CHARGEMENT DES FONCTIONS
source("R/data_processing.R")
source("R/plotting.R")
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
setwd("~/Documents/DU DATAS/STAGE/HYPOXPERF - SpO2/_athlete-visualization-app")
root_dir <- "~/data/PROD"
## Définition du dossier des données
root_dir <- "~_athlete-visualization-app/data/PROD"
athletes <- list.dirs(root_dir, recursive = FALSE)
## Définition du dossier des données
root_dir <- "~/Documents/DU DATAS/STAGE/HYPOXPERF - SpO2/_athlete-visualization-app/data/PROD"
runApp()
runApp()
# DEFINITION DE L'ESPACE DE TRAVAIL
#setwd("~/Documents/DU DATAS/STAGE/HYPOXPERF - SpO2/_athlete-visualization-app")
app_dir <- getwd()
app_dir
root_dir <- file.path(app_dir, "data", "PROD")
root_dir
runApp()
shiny::runApp()
